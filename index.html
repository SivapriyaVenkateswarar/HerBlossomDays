<!DOCTYPE html>
<html>
<head>
    <title>Menstrual Health Chatbot</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        input[type="text"], select { padding: 8px; margin-right: 10px; }
        button { padding: 8px 16px; background-color: #4CAF50; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #45a049; }
        #response { margin-top: 20px; }
        #audio { margin-top: 10px; }
        #audio-error { margin-top: 10px; }
        .tracker { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Menstrual Health Chatbot</h1>
    <input id="query" type="text" placeholder="Ask about periods..." />
    <select id="faith">
        <option value="general">General</option>
        <option value="hindu">Hindu</option>
        <option value="islamic">Islamic</option>
        <option value="christian">Christian</option>
    </select>
    <button onclick="submitQuery()">Ask</button>
    <div id="response"></div>
    <audio id="audio" controls></audio>
    <div id="audio-error" style="color: red;"></div>
    <div class="tracker">
        <h3>Period Tracker</h3>
        <input type="date" id="last-period" />
        <input type="number" id="cycle-length" placeholder="Cycle length (days)" min="21" max="35" value="28" />
        <button onclick="trackPeriod()">Track</button>
        <div id="tracker-result"></div>
    </div>
    <script>
        async function submitQuery() {
            const query = document.getElementById('query').value;
            const faith = document.getElementById('faith').value;
            const audioError = document.getElementById('audio-error');
            audioError.textContent = '';
            try {
                const res = await fetch(`/chat?query=${encodeURIComponent(query)}&faith=${faith}`);
                if (!res.ok) {
                    throw new Error(`HTTP error: ${res.status}`);
                }
                const data = await res.json();
                document.getElementById('response').innerHTML = `
                    <p><strong>Response:</strong> ${data.text_response}</p>
                    <p><strong>Quote:</strong> ${data.quote}</p>
                `;
                const audio = document.getElementById('audio');
                if (data.voice_support) {
                    audio.src = `/audio?t=${new Date().getTime()}`;
                    audio.load();
                    audio.play().catch(e => {
                        audioError.textContent = `Error playing audio: ${e.message}`;
                    });
                } else {
                    audio.src = '';
                }
            } catch (error) {
                document.getElementById('response').innerHTML = `
                    <p><strong>Error:</strong> ${error.message}</p>
                `;
            }
        }

        function trackPeriod() {
            const lastPeriod = new Date(document.getElementById('last-period').value);
            const cycleLength = parseInt(document.getElementById('cycle-length').value);
            if (lastPeriod && cycleLength) {
                const nextPeriod = new Date(lastPeriod.getTime() + cycleLength * 24 * 60 * 60 * 1000);
                document.getElementById('tracker-result').innerHTML = `Estimated next period: ${nextPeriod.toISOString().split('T')[0]}`;
            } else {
                document.getElementById('tracker-result').innerHTML = 'Please enter valid date and cycle length.';
            }
        }
    </script>
</body>
</html>